/*! Trivial Components | (c) 2015 Yann Massard and others | Apache License, Version 2.0 (https://raw.githubusercontent.com/trivial-components/trivial-components/master/LICENSE) */
!function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-core",["jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("mustache")):jQuery&&!window.TrivialComponents&&(window.TrivialComponents=e())}(function(){function e(e){return'<div class="tr-tagbox-default-wrapper-template"><div class="tr-tagbox-tag-content">##entryTemplate##</div><div class="tr-tagbox-tag-remove-button"></div></div>'.replace("##entryTemplate##",e)}function t(e){return-1!=[h.shift,h.caps_lock,h.alt,h.ctrl,h.left_window_key,h.right_window_key].indexOf(e.which)}function n(e,t,n){var r=t.charAt(0).toUpperCase()+t.slice(1),i=t.toLowerCase(),a=t.charAt(0).toLocaleLowerCase()+t.slice(1);$.fn[i]=function(t){var r=[];return this.each(function(){var i=$(this).parents("."+n).addBack("."+n);if(i.length>0&&i[0][a])r.push(i[0][a].$);else{var o=new e(this,t);r.push(o.$)}}),$(r)},$.fn[r]=function(t){var r=[];return this.each(function(){var i=$(this).parents("."+n).addBack("."+n);if(i.length>0&&i[0][a])r.push(i[0][a]);else{var o=new e(this,t);r.push(o)}}),1==r.length?r[0]:r}}function r(e,t,n){e=e.firstChild||e,n=n||t;var r=document.createRange();r.setStart(e,t),r.setEnd(e,n);var i=window.getSelection();i.removeAllRanges(),i.addRange(r)}function i(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var a='<div class="tr-template-image-2-lines">  <div class="img-wrapper" style="background-image: url({{imageUrl}})"></div>  <div class="content-wrapper editor-area">     <div class="main-line">{{displayValue}}</div>     <div class="additional-info">{{additionalInfo}}</div>  </div></div>',o='<div class="tr-template-round-image-2-lines-color-bubble">  {{#imageUrl}}<div class="img-wrapper" style="background-image: url({{imageUrl}})"></div>{{/imageUrl}}  <div class="content-wrapper editor-area">     <div class="main-line">{{displayValue}}</div>     <div class="additional-info">{{#statusColor}}<span class="status-bubble" style="background-color: {{statusColor}}"></span>{{/statusColor}}{{additionalInfo}}</div>  </div></div>',l='<div class="tr-template-icon-2-lines">  <div class="img-wrapper" style="background-image: url({{imageUrl}})"></div>  <div class="content-wrapper editor-area">     <div class="main-line">{{displayValue}}</div>     <div class="additional-info">{{additionalInfo}}</div>  </div></div>',s='<div class="tr-template-icon-single-line">  <div class="img-wrapper" style="background-image: url({{imageUrl}})"></div>  <div class="content-wrapper editor-area">{{displayValue}}</div></div>',u='<div class="tr-template-single-line">  <div class="content-wrapper editor-area">     <div>{{displayValue}}</div>   </div></div>',d='<div class="tr-template-currency-single-line-short">  <div class="content-wrapper editor-area">     <div>{{#symbol}}<span class="currency-symbol">{{symbol}}</span>{{/symbol}} {{#code}}<span class="currency-code">{{code}}</span>{{/code}}</div>   </div></div>',c='<div class="tr-template-currency-single-line-long">  <div class="content-wrapper editor-area">     <div class="symbol-and-code">{{#code}}<span class="currency-code">{{code}}</span>{{/code}} {{#symbol}}<span class="currency-symbol">{{symbol}}</span>{{/symbol}}</div>    <div class="currency-name">{{name}}</div>  </div></div>',p='<div class="tr-template-currency-2-lines">  <div class="content-wrapper editor-area">     <div class="main-line">      <span class="currency-code">{{code}}</span>      <span class="currency-name">{{name}}</span>    </div>     <div class="additional-info">      <span class="currency-symbol">{{symbol}}</span>&nbsp;      {{#exchangeRate}}      <div class="exchange">        =         <span class="exchange-rate">{{exchangeRate}}</span>        <span class="exchange-rate-base">{{exchangeRateBase}}</span>      </div>      {{/exchangeRate}}    </div>  </div></div>',h={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert:45,"delete":46,left_window_key:91,right_window_key:92,select_key:93,num_lock:144,scroll_lock:145,specialKeys:[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,91,92,93,144,145],numberKeys:[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105]},f=function(e,t){function n(n){for(var r=[],i=0;i<e.length;i++){var a=e[i],o=a._trEntryElement;(!n||$.trivialMatch(o.text().trim().replace(/\s{2,}/g," "),n,t).length>0)&&r.push(a)}return r}return function(e,t){t(n(e))}},y=function(e,t,n,r){function i(e){var t=function(){};return t.prototype=e,new t}function a(e,t){var l=i(e);if(l[n]=[],l[r]=!1,e[n])for(var s=0;s<e[n].length;s++){var u=e[n][s],d=a(u,t);d&&(l[n].push(d),l[r]=!0)}var c=l[n].length>0,p=o(e,t);return p&&!c&&(l[n]=e[n]),p||c?l:null}function o(e,n){var r=e._trEntryElement;return!n||$.trivialMatch(r.text().trim().replace(/\s{2,}/g," "),n,t).length>0}return function(t,n){if(t){for(var r=[],i=0;i<e.length;i++){var o=e[i],l=a(o,t);l&&r.push(l)}n(r)}else n(e)}};return{image2LinesTemplate:a,roundImage2LinesColorBubbleTemplate:o,icon2LinesTemplate:l,iconSingleLineTemplate:s,singleLineTemplate:u,currencySingleLineShortTemplate:d,currencySingleLineLongTemplate:c,currency2LineTemplate:p,defaultSpinnerTemplate:'<div class="tr-default-spinner"><div class="spinner"></div><div>Fetching data...</div></div>',defaultNoEntriesTemplate:'<div class="tr-default-no-data-display"><div>No matching entries...</div></div>',wrapEntryTemplateWithDefaultTagWrapperTemplate:e,keyCodes:h,defaultListQueryFunctionFactory:f,defaultTreeQueryFunctionFactory:y,isModifierKey:t,registerJqueryPlugin:n,selectElementContents:r,escapeSpecialRegexCharacter:i}}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-calendarbox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialcalendarbox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(e,n){function r(e,t){for(var n=e.clone().utc().startOf("month").hour(12),r=n.clone().isoWeekday(t<=n.isoWeekday()?t:t-7),i=[],a=r.clone();i.length<42;a.add(1,"day"))i.push(a.clone());return i}function i(e){C.text(e.year()),P.text(moment.months()[e.month()]),E.remove(),E=t('<div class="month-table">').appendTo(w);for(var n=r(e,1),i=t("<tr>").appendTo(E),a=0;7>a;a++)i.append("<th>"+moment.weekdaysMin()[(g.firstDayOfWeek+a)%7]+"</th>");for(var o=0;o<n.length/7;o++){i=t("<tr>").appendTo(E);for(var l=0;7>l;l++){var s=n[7*o+l],u=t("<td>"+s.date()+"</td>");s.month()==e.month()?u.addClass("current-month"):u.addClass("other-month"),s.year()==moment().year()&&s.dayOfYear()==moment().dayOfYear()&&u.addClass("today"),s.year()==v.year()&&s.dayOfYear()==v.dayOfYear()&&(u.addClass("selected"),"day"===m&&u.addClass("keyboard-nav")),u.click(function(e){return function(){f("day"),d(e.month()+1,e.date())}}(s)),i.append(u)}}}function a(e){S.text(e.hour()>=12?"pm":"am");var t=6*e.minute(),n=e.hour()%12+e.minute()/60,r=30*n;q.attr("transform","rotate("+r+",50,50)"),k.attr("transform","rotate("+t+",50,50)"),O.text(e.format("HH")),M.text(e.format("mm"))}function o(e){v=e,L(),h()}function l(e){v.year(e),L(),h()}function s(e){v.month(e-1),L(),h()}function u(e){v.date(e),L(),h()}function d(e,t){v.month(e-1),v.date(t),L(),h()}function c(e){v.hour(e),L(),h()}function p(e){v.minute(e),L(),h()}function h(){x.trigger("change")}function f(e){m=e,t(T).add(b).add(E.find("td.keyboard-nav")).add(q).add(F).add(k).add(j).each(function(){t(this).attr("class",t(this).attr("class").replace("keyboard-nav",""))}),"year"==m?T.addClass("keyboard-nav"):"month"==m?b.addClass("keyboard-nav"):"day"==m?E.find(".selected").addClass("keyboard-nav"):"hour"==m?(q.attr("class","hourhand keyboard-nav"),F.addClass("keyboard-nav")):"minute"==m&&(k.attr("class","minutehand keyboard-nav"),j.addClass("keyboard-nav"))}function y(e,t){return"year"==e?("down"==t||"left"==t?l(v.year()-1):("up"==t||"right"==t)&&l(v.year()+1),!0):"month"==e?("down"==t||"left"==t?s(v.month()):("up"==t||"right"==t)&&s(v.month()+2),!0):"day"==e?("down"==t?v.dayOfYear(v.dayOfYear()+7):"left"==t?v.dayOfYear(v.dayOfYear()-1):"up"==t?v.dayOfYear(v.dayOfYear()-7):"right"==t&&v.dayOfYear(v.dayOfYear()+1),L(),h(),!0):"hour"==e?("down"==t||"left"==t?c(v.hour()-1):("up"==t||"right"==t)&&c(v.hour()+1),!0):"minute"==e?("down"==t||"left"==t?p(v.minute()-v.minute()%5-5):("up"==t||"right"==t)&&p(v.minute()-v.minute()%5+5),!0):void 0}n=n||{};var g=t.extend({selectedDate:null,firstDayOfWeek:1,mode:"datetime"},n),m="time"==g.mode?"hour":"day",v=g.selectedDate,x=t('<div class="tr-calendarbox"/>').appendTo(e),w=t('<div class="tr-calendar-display"/>').appendTo(x),T=t('<div class="year"><span class="back-button"/><span class="name"/><span class="forward-button"/></div>').appendTo(w),b=t('<div class="month"><span class="back-button"/><span class="name"/><span class="forward-button"/></div>').appendTo(w),E=t('<div class="month-table">').appendTo(w),C=T.find(".name"),P=b.find(".name");T.click(f.bind(this,"year")),T.find(".back-button").click(y.bind(this,"year","left")),T.find(".forward-button").click(y.bind(this,"year","right")),b.click(f.bind(this,"month")),b.find(".back-button").click(y.bind(this,"month","left")),b.find(".forward-button").click(y.bind(this,"month","right"));var _=t('<div class="tr-clock-display"/>').appendTo(x).append('<svg class="clock" viewBox="0 0 100 100" width="100" height="100"> <circle class="clockcircle" cx="50" cy="50" r="45"/> <g class="ticks" > <line x1="50" y1="5.000" x2="50.00" y2="10.00"/> <line x1="72.50" y1="11.03" x2="70.00" y2="15.36"/> <line x1="88.97" y1="27.50" x2="84.64" y2="30.00"/> <line x1="95.00" y1="50.00" x2="90.00" y2="50.00"/> <line x1="88.97" y1="72.50" x2="84.64" y2="70.00"/> <line x1="72.50" y1="88.97" x2="70.00" y2="84.64"/> <line x1="50.00" y1="95.00" x2="50.00" y2="90.00"/> <line x1="27.50" y1="88.97" x2="30.00" y2="84.64"/> <line x1="11.03" y1="72.50" x2="15.36" y2="70.00"/> <line x1="5.000" y1="50.00" x2="10.00" y2="50.00"/> <line x1="11.03" y1="27.50" x2="15.36" y2="30.00"/> <line x1="27.50" y1="11.03" x2="30.00" y2="15.36"/> </g> <g class="numbers"> <text x="50" y="22">12</text> <text x="85" y="55">3</text> <text x="50" y="88">6</text> <text x="15" y="55">9</text> </g> <g class="hands"> <line class="minutehand" x1="50" y1="50" x2="50" y2="20"/> <line class="hourhand" x1="50" y1="50" x2="50" y2="26"/> </g> <g class="am-pm-box"><rect x="58" y="59" width="20" height="15"/><text class="amPmText" x="60" y="70" >??</text></g></svg>').append('<div class="digital-time-display"><div class="hour-wrapper"><div class="up-button"/><div class="hour">??</div><div class="down-button"/></div>:<div class="minute-wrapper"><div class="up-button"/><div class="minute">??</div><div class="down-button"/></div></div>'),q=_.find(".hourhand"),k=_.find(".minutehand"),S=_.find(".amPmText"),F=_.find(".digital-time-display .hour-wrapper"),O=_.find(".digital-time-display .hour");F.click(f.bind(this,"hour")),F.find(".up-button").click(y.bind(this,"hour","up")),F.find(".down-button").click(y.bind(this,"hour","down"));var j=_.find(".digital-time-display .minute-wrapper"),M=_.find(".digital-time-display .minute");j.click(f.bind(this,"minute")),j.find(".up-button").click(y.bind(this,"minute","up")),j.find(".down-button").click(y.bind(this,"minute","down")),v?(i(v),a(v)):(i(moment()),a(moment()));var L=function(){i(v),a(v)};this.$=x,this.setSelectedDate=o,this.getSelectedDate=function(){return v},this.setYear=l,this.setMonth=s,this.setDayOfMonth=u,this.setHour=c,this.setMinute=p,this.setKeyboardNavigationState=f,this.navigate=function(e){y(m,e)}}return e.registerJqueryPlugin(r,"TrivialCalendarBox","tr-calendarbox"),t.fn.TrivialCalendarBox}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-calendarcombobox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialcalendarcombobox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(n,r){function a(){p&&(T.text(o(p.date(),2)),b.text(o(p.month()+1,2)),E.text(p.year()),C.text(o(p.hour(),2)),P.text(o(p.minute(),2)))}function o(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function l(){m.addClass("open"),x.show().position({my:"left top",at:"left bottom",of:m,collision:"flip",using:function(e,n){"top"===n.vertical?(m.removeClass("dropdown-flipped"),t(this).removeClass("flipped")):(m.addClass("dropdown-flipped"),t(this).addClass("flipped")),t(this).css({left:e.left+"px",top:e.top+"px"})}}).width(m.width()),c=!0}function s(){m.removeClass("open"),x.hide(),c=!1}r=r||{};var u,d=t.extend({selectedDate:null,firstDayOfWeek:1,showTrigger:!0},r),c=!1,p=(d.entries,null),h=null,f=!1,y=!1,g=t(n),m=t('<div class="tr-calendarcombobox tr-input-wrapper"/>').insertAfter(g);if(d.showTrigger){var v=t('<div class="tr-trigger"><span class="tr-trigger-icon"/></div>').appendTo(m);v.mousedown(function(){return c?s():(-1==q.get().indexOf(document.activeElement)&&q.first().focus(),l()),!1})}var x=t('<div class="tr-calendarcombobox-dropdown tr-dropdown"></div>').appendTo("body"),w=t('<div class="tr-formatted-field"></div>'),T=t('<span class="dayInput tr-formatted-input-section tr-2-chars right" contenteditable="true" data-maxlength="2" data-placeholder="TT"></span>').appendTo(w);w.append('<span class="separator">.</span>');var b=t('<span class="monthInput tr-formatted-input-section tr-2-chars right" contenteditable="true" data-maxlength="2" data-placeholder="MM"></span>').appendTo(w);w.append('<span class="separator">.</span>');var E=t('<span class="yearInput tr-formatted-input-section tr-4-chars right" contenteditable="true" data-maxlength="4" data-placeholder="JJJJ"></span>').appendTo(w);w.append('<span class="separator"> &nbsp;&nbsp; </span>');var C=t('<span class="hourInput tr-formatted-input-section tr-2-chars right" contenteditable="true" data-maxlength="2" data-placeholder="ss"></span>').appendTo(w);w.append('<span class="separator">:</span>');var P=t('<span class="minuteInput tr-formatted-input-section tr-2-chars right" contenteditable="true" data-maxlength="2" data-placeholder="mm"></span>').appendTo(w);w.append('<span class="separator"> &nbsp;&nbsp; </span>');var _=t('<span class="timeZoneInput tr-formatted-input-section tr-3-chars right" contenteditable="true" data-maxlength="3" data-placeholder="ZZ">CET</span>').appendTo(w),q=w.find("[contenteditable='true']");q.not(q.first()).attr("tabindex","-1"),w.find(".tr-formatted-input-section").on("keydown",function(e){var n=t(this),r=-1!=i.specialKeys.indexOf(e.which),a=n.text().length>=parseInt(n.attr("data-maxlength")),o=window.getSelection().anchorOffset===window.getSelection().focusOffset;!r&&a&&o&&e.preventDefault()}),g.addClass("tr-original-input"),q.focus(function(e){e.target==E[0]?u.setKeyboardNavigationState("year"):e.target==b[0]?u.setKeyboardNavigationState("month"):e.target==T[0]?u.setKeyboardNavigationState("day"):e.target==C[0]?u.setKeyboardNavigationState("hour"):e.target==P[0]?u.setKeyboardNavigationState("minute"):e.target==_[0]&&u.setKeyboardNavigationState("timeZone"),m.addClass("focus")}).blur(function(e){f||(h?t(e.target).focus():(m.removeClass("focus"),s()))}).keydown(function(n){if(n.which!=i.tab&&!e.isModifierKey(n)){if((n.which==i.backspace||n.which==i["delete"])&&(y=!0),n.which==i.up_arrow)return l(),n.target==T[0]?u.navigate("right"):u.navigate("up"),e.selectElementContents(n.target,0,t(n.target).text().length),!1;if(n.which==i.down_arrow)return l(),n.target==T[0]?u.navigate("left"):u.navigate("down"),e.selectElementContents(n.target,0,t(n.target).text().length),!1;if(n.which==i.left_arrow){var r=q.get().indexOf(n.target);if(0!=r&&0==window.getSelection().anchorOffset){var a=q.eq(r-1);return f=!0,a.focus(),e.selectElementContents(a[0],a.text().length),!1}}else if(n.which==i.right_arrow){var r=q.get().indexOf(n.target);if(r!=q.length-1&&window.getSelection().anchorOffset==t(n.target).text().length){var a=q.eq(q.get().indexOf(n.target)+1);return f=!0,a.focus(),!1}}else c&&n.which==i.enter?(s(),w.select()):n.which==i.escape?(s(),clearEditorIfNotContainsFreeText()):l()}}),w.prependTo(m).mousedown(function(e){return l(),-1==q.get().indexOf(e.target)?-1!=q.get().indexOf(document.activeElement)?!1:(q.first().focus(),!1):void 0}),m.add(x).add(v).mousedown(function(e){m.is(".focus")&&(-1!=q.get().indexOf(document.activeElement)?f=!0:h=!0)}).on("mouseout mouseup",function(){(h||f)&&(h=!1,f=!1)}),u=x.TrivialCalendarBox(d),u.$.change(function(){var e=u.getSelectedDate();e&&(p=e,a())}),u.setSelectedDate(d.selectedDate||null),this.$=m,m[0].trivialCalendarComboBox=this}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialCalendarComboBox","tr-calendarcombobox"),t.fn.TrivialCalendarComboBox}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-combobox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialcombobox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,a){function o(e){var n=t(x.spinnerTemplate).appendTo(j);q=q.add(n),setTimeout(function(){x.queryFunction(L.val(),function(t){v(t,e)})})}function l(){k.triggerHandler("change"),S.trigger("change")}function s(e){if(null==e){x.valueProperty&&k.val(""),E=null;var r=t(n.render(x.selectedEntryTemplate,x.emptyEntry)).addClass("tr-combobox-entry").addClass("empty");F.empty().append(r)}else{x.valueProperty&&k.val(e[x.valueProperty]),E=e;var r=t(n.render(x.selectedEntryTemplate,e)).addClass("tr-combobox-entry");F.empty().append(r),L.val(e[x.inputTextProperty])}l()}function u(){return null!=E&&E!==x.emptyEntry}function d(){var e=F.find(".editor-area");L.css({width:e.width()+"px",height:e.height()+"px"}).position({my:"left top",at:"left top",of:e})}function c(){x.allowFreeText||u()||!(k.val().length>0||L.val().length>0)||(k.val(""),L.val(""),b=null,l())}function p(){x.allowFreeText&&L.val().length>0&&!u()||h()}function h(){L.width(0).height(0)}function f(){M&&(S.addClass("open"),N(),T=!0)}function y(){S.removeClass("open"),j.hide(),T=!1}function g(){return L.val().substring(0,L[0].selectionStart)}function m(e){if(x.autoComplete){clearTimeout(P);var t=w.getHighlightedEntry();if(t&&!_){var n=t[x.inputTextProperty];P=setTimeout(function(){var e,t=g();e=0===n.toLowerCase().indexOf(t.toLowerCase())?t+n.substr(t.length):g(),L.val(e),setTimeout(function(){L[0].setSelectionRange(t.length,e.length)},0)},e||0)}_=!1}}function v(e,n){n=void 0===n?1:n,b=e,q.remove(),q=t(),w.updateEntries(e);var r=g();r.length>0?(w.highlightTextMatches(r),w.highlightNextMatchingEntry(n)):w.highlightNextEntry(n),m(x.autoCompleteDelay),T&&f()}a=a||{};var x=t.extend({valueProperty:null,inputTextProperty:"displayValue",template:e.image2LinesTemplate,selectedEntryTemplate:a.template||e.image2LinesTemplate,selectedEntry:void 0,spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,emptyEntry:{},queryFunction:null,autoComplete:!0,autoCompleteDelay:0,allowFreeText:!1,freeTextEntryValues:{_isFreeTextEntry:!0},showTrigger:!0,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2},editingMode:"editable"},a);x.queryFunction=x.queryFunction||e.defaultListQueryFunctionFactory(x.entries||[],x.matchingOptions);var w,T=!1,b=x.entries,E=null,C=!1,P=-1,_=!1,q=t(),k=t(r),S=t('<div class="tr-combobox tr-input-wrapper"/>').addClass(x.editingMode).insertAfter(k),F=t('<div class="tr-combobox-selected-entry-wrapper"/>').appendTo(S);if(x.showTrigger){var O=t('<div class="tr-trigger"><span class="tr-trigger-icon"/></div>').appendTo(S);O.mousedown(function(){T?(d(),y()):setTimeout(function(){d(),L.select(),f(),null==b&&o()})})}var j=t('<div class="tr-dropdown"></div>').scroll(function(e){return!1}),M="editable"==x.editingMode&&(x.entries&&x.entries.length>0||a.queryFunction||x.showTrigger);M&&j.appendTo("body");var L;x.valueProperty?(k.addClass("tr-original-input"),L=t('<input type="text"/>')):L=k,L.prependTo(S).addClass("tr-combobox-editor tr-editor").focus(function(){C||S.addClass("focus")}).blur(function(){C?L.focus():(S.removeClass("focus"),c(),p(),y())}).keydown(function(t){if(t.which!=i.tab&&!e.isModifierKey(t)){if(t.which==i.left_arrow||t.which==i.right_arrow)return void d();if((t.which==i.backspace||t.which==i["delete"])&&(_=!0),t.which==i.up_arrow||t.which==i.down_arrow){d(),f();var n=t.which==i.up_arrow?-1:1;if(null!=b)return w.highlightNextEntry(n),m(x.autoCompleteDelay),!1;o(n)}else T&&t.which==i.enter?(s(w.getHighlightedEntry()),y(),p(),L.select()):t.which==i.escape?(y(),c(),p()):(d(),f(),o(1))}}).keyup(function(t){!e.isModifierKey(t)&&t.which!=i.enter&&u()&&L.val()!==E[x.inputTextProperty]?s(null):t.which==i.tab&&d()}).mousedown(function(){f(),null==b&&o()}),S.add(j).mousedown(function(){L.is(":focus")&&(C=!0)}).mouseup(function(){C&&(L.focus(),C=!1)}).mouseout(function(){C&&(L.focus(),C=!1)}),w=j.TrivialListBox(x),w.$.change(function(){var e=w.getSelectedEntry();e&&(s(e),w.selectEntry(null),y()),p()}),s(x.selectedEntry||null),F.click(function(){d(),L.select(),f(),null==b&&o()});var N=function(){j.show().position({my:"left top",at:"left bottom",of:S,collision:"flip",using:function(e,n){"top"===n.vertical?(S.removeClass("dropdown-flipped"),t(this).removeClass("flipped")):(S.addClass("dropdown-flipped"),t(this).addClass("flipped")),t(this).css({left:e.left+"px",top:e.top+"px"})}}).width(S.width())};this.$=S,S[0].trivialComboBox=this,this.updateEntries=v,this.getSelectedEntry=function(){if(null!=E||x.allowFreeText&&L.val()){if(null==E&&x.allowFreeText){var e=t.extend({},x.freeTextEntryValues);return e[x.inputTextProperty]=L.val(),e}var n=jQuery.extend({},E);return n._trEntryElement=void 0,n}return null},this.selectEntry=s}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialComboBox","tr-combobox"),t.fn.TrivialComboBox}),function(e){e.expr[":"].containsIgnoreCase=e.expr.createPseudo(function(t){return function(n){return e(n).text().toUpperCase().indexOf(t.toUpperCase())>=0}})}(jQuery),function(e){e.trivialMatch=function(t,n,r){function i(e){for(var n,r=[];n=e.exec(t);)r.push({start:n.index,length:n[0].length});return r}function a(e,t){var n=new Levenshtein(e,t);return n.distance<=r.maxLevenshteinDistance?[{start:0,length:t.length,distance:n.distance}]:[]}if(!n)throw"searchString may not be empty!";var r=e.extend({matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:3},r||null);if(r.ignoreCase&&(t=t.toLowerCase(),n=n.toLowerCase()),"contains"==r.matchingMode)return n=n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i(new RegExp(n,"g"));if("prefix"==r.matchingMode)return n=n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i(new RegExp("^"+n,"g"));if("prefix-word"==r.matchingMode)return n=n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i(n.charAt(0).match(/^\w/)?new RegExp("\\b"+n,"g"):new RegExp(n,"g"));if("prefix-levenshtein"==r.matchingMode)return a(t.substr(0,Math.min(n.length,t.length)),n);if("levenshtein"==r.matchingMode)return a(t,n);throw"unknown matchingMode: "+r.matchingMode}}(jQuery),function(e){e.fn.trivialHighlight=function(t,n){return n=e.extend({highlightClassName:"tr-highlighted-text",matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:3},n),this.find("*").each(function(){var r=e(this);r.find("."+n.highlightClassName).contents().unwrap(),this.normalize(),t&&""!==t&&r.contents().filter(function(){return 3==this.nodeType&&e.trivialMatch(this.nodeValue,t,n).length>0}).replaceWith(function(){for(var r=this.nodeValue||"",i="",a=e.trivialMatch(this.nodeValue,t,n),o=0,l=0;l<a.length;l++){var s=a[l];i+=this.nodeValue.substring(o,s.start),i+='<span class="'+n.highlightClassName+'">'+r.substr(s.start,s.length)+"</span>",o=s.start+s.length}return i+=r.substring(o,r.length)})})}}(jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-list",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.triviallist&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,a){function o(e){var t=m.filter(function(t){return t[y.valueProperty]==e});return t&&t.length>0?t[0]:null}function l(e){if(b.empty(),e.length>0)for(var r=0;r<e.length;r++){var i=e[r],a=n.render(y.template,i),o=t(a).addClass("tr-list-entry filterable-item").appendTo(b);i._trEntryElement=o,function(e){o.mousedown(function(){x=!0,c(e),E.select()}).mouseup(function(){x&&(E.focus(),x=!1)}).mouseout(function(){x&&(E.focus(),x=!1)}).mouseover(function(){d(e)})}(i)}else b.append(y.noEntriesTemplate)}function s(e,t){v=null,m=e,l(m),m.length>0?(f(),"undefined"!=typeof t&&p(t)):d(null)}function u(e){b.append(y.spinnerTemplate),setTimeout(function(){y.queryFunction(E.val(),function(t){s(t,e)})})}function d(e){v=e,b.find(".tr-list-entry").removeClass("tr-highlighted-entry"),null!=e&&(e._trEntryElement.addClass("tr-highlighted-entry"),b.minimallyScrollTo(e._trEntryElement))}function c(e){b.find(".tr-selected-entry").removeClass("tr-selected-entry"),null==e?w.val(""):(w.val(e[y.valueProperty]),g=e,g._trEntryElement.addClass("tr-selected-entry"))}function p(e){var t=h(e);null!=t&&d(t)}function h(e){var t;if(null==m||0==m.length)return null;if(null==v&&e>0)t=-1+e;else if(null==v&&0>e)t=m.length+e;else{var n=m.indexOf(v);t=(n+m.length+e)%m.length}return m[t]}function f(){for(var e=0;e<m.length;e++){var t=m[e]._trEntryElement;t.trivialHighlight(E.val(),y.matchingOptions)}}a=a||{};var y=t.extend({valueProperty:null,template:e.image2LinesTemplate,spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,selectedEntryId:null,queryFunction:null,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2}},a);y.queryFunction=y.queryFunction||e.defaultListQueryFunctionFactory(y.entries||[],y.matchingOptions);var g,m=y.entries,v=null,x=!1,w=t(r).addClass("tr-original-input"),T=t('<div class="tr-list"/>').insertAfter(w),b=t('<div class="tr-list-entryList"></div>').appendTo(T),E=t('<input type="text" class="tr-list-editor tr-editor"/>').prependTo(T).focus(function(){T.addClass("focus")}).blur(function(){x?E.focus():(T.removeClass("focus"),d(null))}).keydown(function(t){if(t.which!=i.tab&&!e.isModifierKey(t)&&t.which!=i.left_arrow&&t.which!=i.right_arrow)if(t.which==i.up_arrow||t.which==i.down_arrow){var n=t.which==i.up_arrow?-1:1;if(null!=m)return p(n),!1;u(n)}else t.which==i.enter?(c(v),E.select()):t.which==i.escape?d(null):u(1)}).keyup(function(e){}).mousedown(function(){null==m&&u()});T.add(b).mousedown(function(){E.is(":focus")&&(x=!0)}).mouseup(function(){x&&(E.focus(),x=!1)}).mouseout(function(){x&&(E.focus(),x=!1)}),b.mouseout(function(){d(null)}),m&&l(m),c(y.selectedEntryId?o(y.selectedEntryId):null),this.$=T,T[0].trivialList=this,this.updateEntries=s,this.getSelectedEntry=function(){return g}}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialList","tr-list"),t.fn.TrivialList}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-listbox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.triviallistbox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,i){function a(e){if(x.empty(),e.length>0)for(var r=0;r<e.length;r++){var i,a=e[r];if(a._trEntryElement)i=a._trEntryElement;else{var o=n.render(y.template,a);i=t(o).addClass("tr-listbox-entry filterable-item")}i.appendTo(x),a._trEntryElement=i,function(e){i.mousedown(function(t){v.trigger("mousedown",t),d(e)}).mouseup(function(e){v.trigger("mouseup",e)}).mouseenter(function(){s(e)})}(a)}else x.append(y.noEntriesTemplate)}function o(e,t){m=null,g=e,a(g),g.length>0?(g.length<=y.textHighlightingEntryLimit&&h(),"undefined"!=typeof t&&c(t)):s(null)}function l(e){v.parent().minimallyScrollTo(e)}function s(e){e!==m&&(m=e,x.find(".tr-listbox-entry").removeClass("tr-highlighted-entry"),null!=e&&(e._trEntryElement.addClass("tr-highlighted-entry"),l(e._trEntryElement)))}function u(){v.trigger("change")}function d(e){f=e,x.find(".tr-selected-entry").removeClass("tr-selected-entry"),null!=e&&f._trEntryElement.addClass("tr-selected-entry"),u()}function c(e){var t=p(e);null!=t&&s(t)}function p(e){var t;if(null==g||0==g.length)return null;if(null==m&&e>0)t=-1+e;else if(null==m&&0>e)t=g.length+e;else{var n=g.indexOf(m);t=(n+g.length+e)%g.length}return g[t]}function h(e){for(var t=0;t<g.length;t++){var n=g[t]._trEntryElement;n.trivialHighlight(e,y.matchingOptions)}}i=i||{};var f,y=t.extend({template:e.image2LinesTemplate,spinnerTemplate:e.defaultSpinnerTemplate,entries:null,queryFunction:null,textHighlightingEntryLimit:100,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2}},i),g=y.entries,m=null,v=t('<div class="tr-listbox"/>').appendTo(r).mouseleave(function(){s(null)}),x=t('<div class="tr-listbox-entry-list"></div>').appendTo(v);g&&a(g),this.$=v,v[0].trivialListBox=this,this.updateEntries=o,this.getSelectedEntry=function(){if(f){var e=jQuery.extend({},f);return e._trEntryElement=void 0,e}return null},this.selectEntry=d,this.highlightNextEntry=c,this.highlightNextMatchingEntry=function(e){var t=p(e);null!=t&&s(t)},this.getHighlightedEntry=function(){return m},this.highlightTextMatches=h}return e.registerJqueryPlugin(r,"TrivialListBox","tr-listbox"),t.fn.TrivialListBox}),$.fn.minimallyScrollTo=function(e){return this.each(function(){var t=$(this),n=t.scrollTop(),r=n+t.innerHeight(),i=$(e).offset().top-$(this).offset().top+t.scrollTop(),a=i+e.height();n>i?t.scrollTop(i):a>r&&t.scrollTop(Math.min(i,a-t.innerHeight()))})},function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-tagbox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialtagbox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,a){function o(e){if(L.empty(),e.length>0)for(var r=0;r<e.length;r++){var i=e[r],a=n.render(b.template,i),o=t(a).addClass("tr-tagbox-entry filterable-item").appendTo(L);i._trEntryElement=o,function(e){o.mousedown(function(){q=!0,h(e),Q.select(),g()}).mouseup(function(){q&&(Q.focus(),q=!1)}).mouseout(function(){q&&(Q.focus(),q=!1)}).mouseover(function(){d(e)})}(i)}else L.append(b.noEntriesTemplate)}function l(e,t){_=null,C=e,o(C),C.length>0?(T(),"undefined"!=typeof t&&x(t)):d(null)}function s(e){var t=P.indexOf(e);t>-1&&P.splice(t,1),e._trEntryElement.remove(),F.val(p()),c()}function u(e){L.append(b.spinnerTemplate),setTimeout(function(){b.queryFunction(Q.text().replace(String.fromCharCode(160)," "),function(t){l(t,e),E&&y()})})}function d(e){_=e,L.find(".tr-tagbox-entry").removeClass("tr-highlighted-entry"),null!=e&&(e._trEntryElement.addClass("tr-highlighted-entry"),L.minimallyScrollTo(e._trEntryElement))}function c(){F.trigger("change"),O.trigger("change")}function p(){return P.map(function(e){return e[b.valueProperty]}).join(b.valueSeparator)}function h(e){if(null!=e&&!(b.maxSelectedEntries&&P.length>=b.maxSelectedEntries||b.distinct&&-1!=P.map(function(e){return e[b.valueProperty]}).indexOf(e[b.valueProperty]))){var r=t.extend({},e);P.push(r),F.val(p());var i=t(n.render(b.selectedEntryTemplate,r));i.find(".tr-tagbox-tag-remove-button").click(function(e){return s(r),!1});var a=t('<div class="tr-tagbox-tag"></div>');a.append(i).insertBefore(Q),r._trEntryElement=a,Q.text(""),c()}}function f(){L.position({my:"left top",at:"left bottom",of:O,collision:"flip",using:function(e,n){"top"===n.vertical?(O.removeClass("dropdown-flipped"),t(this).removeClass("flipped")):(O.addClass("dropdown-flipped"),t(this).addClass("flipped")),t(this).css({left:e.left+"px",top:e.top+"px"})}}).width(O.width());
}function y(){N&&(O.addClass("open"),L.show(),f(),E=!0)}function g(){O.removeClass("open"),L.hide(),E=!1}function m(){var e=Q.text().replace(String.fromCharCode(160)," "),t=window.getSelection();return t.anchorOffset!=t.focusOffset?e.substring(0,Math.min(window.getSelection().baseOffset,window.getSelection().focusOffset)):e}function v(t,n){clearTimeout(k),S||(k=setTimeout(function(){var n,r=m();n=0===t.toLowerCase().indexOf(r.toLowerCase())?r+t.substr(r.length):m(),Q.text(n),f(),setTimeout(function(){e.selectElementContents(Q[0],r.length,n.length)},0)},n||0)),S=!1}function x(e){var t=w(e);null!=t&&(d(t),b.autoComplete&&v(t[b.inputTextProperty],b.autoCompleteDelay))}function w(e){var t;if(null==C||0==C.length)return null;if(null==_&&e>0)t=-1+e;else if(null==_&&0>e)t=C.length+e;else{var n=C.indexOf(_);t=(n+C.length+e)%C.length}return C[t]}function T(){for(var e=m(),t=0;t<C.length;t++){var n=C[t]._trEntryElement;n.trivialHighlight(e,b.matchingOptions)}}a=a||{};var b=t.extend({valueProperty:"displayValue",valueSeparator:",",inputTextProperty:"displayValue",template:e.image2LinesTemplate,selectedEntryTemplate:a.template?e.wrapEntryTemplateWithDefaultTagWrapperTemplate(a.template):e.wrapEntryTemplateWithDefaultTagWrapperTemplate(e.image2LinesTemplate),spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,selectedEntries:[],maxSelectedEntries:null,queryFunction:null,autoComplete:!0,autoCompleteDelay:0,allowFreeText:!0,freeTextSeparators:[",",";"],freeTextEntryValues:{_isFreeTextEntry:!0},showTrigger:!0,distinct:!0,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2},editingMode:"editable"},a);b.queryFunction=b.queryFunction||e.defaultListQueryFunctionFactory(b.entries||[],b.matchingOptions);var E=!1,C=b.entries,P=[],_=null,q=!1,k=-1,S=!1,F=t(r).addClass("tr-original-input"),O=t('<div class="tr-tagbox tr-input-wrapper"/>').addClass(b.editingMode).insertAfter(F);F.appendTo(O);var j=t('<div class="tr-tagbox-tagarea"/>').appendTo(O);if(b.showTrigger){var M=t('<div class="tr-trigger"><span class="tr-trigger-icon"/></div>').appendTo(O);M.mousedown(function(){E?g():setTimeout(function(){Q.select(),y(),null==C&&u()})})}var L=t('<div class="tr-dropdown"></div>').scroll(function(e){return!1}),N="editable"==b.editingMode&&(b.entries&&b.entries.length>0||a.queryFunction||b.showTrigger);N&&L.appendTo("body");var Q=t('<span contenteditable="true" class="tagbox-editor"></span>');Q.appendTo(j).addClass("tr-tagbox-editor tr-editor").focus(function(){q||O.addClass("focus")}).blur(function(){if(q)Q.focus();else{if(O.removeClass("focus"),C=null,g(),b.allowFreeText&&Q.text().trim().length>0){var e=t.extend({},b.freeTextEntryValues);e[b.inputTextProperty]=Q.text(),h(e)}Q.text("")}}).keydown(function(n){if(n.which!=i.tab&&!e.isModifierKey(n)&&n.which!=i.left_arrow&&n.which!=i.right_arrow)if(n.which!=i.backspace&&n.which!=i["delete"])if(n.which==i.up_arrow||n.which==i.down_arrow){y();var r=n.which==i.up_arrow?-1:1;if(null!=C)return x(r),!1;u(r)}else if(n.which==i.enter){if(E&&null!=_)h(_),C=null;else if(b.allowFreeText&&Q.text().trim().length>0){var a=t.extend({},b.freeTextEntryValues);a[b.inputTextProperty]=Q.text(),h(a)}g()}else n.which==i.escape?(g(),Q.text("")):(y(),u(1));else if(""==Q.text()){if(P.length>0){var o=P[P.length-1];s(o),g()}}else S=!0,u(1)}).keyup(function(t){function n(t,n){return t.split(new RegExp("["+e.escapeSpecialRegexCharacter(n.join())+"]"))}if(Q.find("*").length>0&&Q.text(Q.text()),b.allowFreeText){var r=m();if(r.length>0)for(var i=n(r,b.freeTextSeparators),a=0;a<i.length-1;a++){var o=i[a].trim();if(o.length>0){var l={};l[b.inputTextProperty]=o,h(l)}Q.text(i[i.length-1]),e.selectElementContents(Q[0],Q.text().length,Q.text().length),C=null,g()}}}).mousedown(function(){y(),null==C&&u()}),O.add(L).mousedown(function(){Q.is(":focus")&&(q=!0)}).mouseup(function(){q&&(Q.focus(),q=!1)}).mouseout(function(){q&&(Q.focus(),q=!1)}),C&&o(C),j.click(function(){Q.select(),y(),null==C&&u()});for(var D=0;D<b.selectedEntries.length;D++)h(b.selectedEntries[D]);this.$=O,O[0].trivialTagBox=this,this.updateEntries=l,this.getSelectedEntries=function(){for(var e=[],t=0;t<P.length;t++){var n=jQuery.extend({},P[t]);n._trEntryElement=void 0,e.push(n)}return e}}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialTagBox","tr-tagbox"),t.fn.TrivialTagBox}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-tree",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.Trivialtree&&(window.TrivialTree=e(TrivialComponents,jQuery,Mustache))}(function(e,t,n){function r(n,r){function a(e){y=e,m.remove(),m=t(),h.updateEntries(e)}function o(e){var n=t(p.spinnerTemplate).appendTo(w);m=m.add(n),setTimeout(function(){p.queryFunction(T.val(),function(t){a(t),T.val().length>0?(h.highlightTextMatches(T.val()),h.highlightNextMatchingEntry(e)):h.highlightNextEntry(e)})},0)}function l(e){function t(n,r){if(e.call(this,n)&&r.push(n),n[p.childrenProperty])for(var i=0;i<n[p.childrenProperty].length;i++){var a=n[p.childrenProperty][i];t(a,r)}}for(var n=[],r=0;r<y.length;r++){var i=y[r];t(i,n)}return n}function s(e){return l(function(t){return t[p.valueProperty]==e})[0]}function u(e){f=e?e[p.valueProperty]:null,v.val(e?e[p.valueProperty]:null),d()}function d(){v.trigger("change"),x.trigger("change")}r=r||{};var c={valueProperty:"id",childrenProperty:"children",lazyChildrenFlagProperty:"hasLazyChildren",showSearchField:!0,lazyChildrenQueryFunction:function(e,t){t([])},expandedProperty:"expanded",templates:[e.iconSingleLineTemplate],spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,selectedEntryId:null,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2}},p=t.extend(c,r);p.queryFunction=p.queryFunction||e.defaultTreeQueryFunctionFactory(p.entries||[],p.matchingOptions,p.childrenProperty,p.expandedProperty);var h,f,y=p.entries,g=!1,m=t(),v=t(n).addClass("tr-original-input"),x=t('<div class="tr-tree"/>').insertAfter(v).addClass(p.showSearchField?"":"no-searchfield"),w=t('<div class="tr-tree-entryTree"></div>').appendTo(x),T=t('<input type="text" class="tr-tree-editor tr-editor"/>').prependTo(x).focus(function(){x.addClass("focus")}).blur(function(){g?T.focus():(x.removeClass("focus"),h.setHighlightedEntry(null))}).keydown(function(t){if(t.which!=i.tab&&!e.isModifierKey(t)){if(t.which==i.left_arrow||t.which==i.right_arrow){var n=h.setHighlightedNodeExpanded(t.which==i.right_arrow);return n?!1:void 0}if(t.which==i.up_arrow||t.which==i.down_arrow){var r=t.which==i.up_arrow?-1:1;if(null!=y)return h.highlightNextEntry(r),!1}else t.which==i.enter?(h.selectNode(h.getHighlightedEntry()[p.valueProperty]),T.select()):t.which==i.escape?(T.val(""),o()):o(1)}});h=w.TrivialTreeBox(p),h.$.change(function(){var e=h.getSelectedEntry();e&&u(e)}),x.mousedown(function(){T.is(":focus")&&(g=!0)}).mouseup(function(){g&&(T.focus(),g=!1)}).mouseout(function(){g&&(T.focus(),g=!1)}),w.mouseout(function(){h.setHighlightedEntry(null)}).click(function(){T.focus()}),u(p.selectedEntryId?s(p.selectedEntryId):null),this.$=x,x[0].trivialTree=this,this.updateEntries=a,this.getSelectedEntry=h.getSelectedEntry,this.updateChildren=h.updateChildren,this.updateNode=h.updateNode,this.removeNode=h.removeNode,this.addNode=h.addNode}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialTree","tr-tree"),t.fn.TrivialTree}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-treebox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.TrivialTreeBox&&(window.TrivialTreeBox=e(TrivialComponents,jQuery,Mustache))}(function(e,t,n){function r(r,i){function a(e){return(null==e[q.childrenProperty]||0==e[q.childrenProperty].length)&&!e[q.lazyChildrenFlagProperty]}function o(e,r){return t(n.render(q.templates[Math.min(q.templates.length-1,r)],e))}function l(e,n){var r=a(e),i=t('<div class="tr-tree-entry-outer-wrapper '+(r?"":"has-children")+'" data-depth="'+n+'"></div>');e._trEntryElement=i;for(var s=t('<div class="tr-tree-entry-and-expander-wrapper"></div>').appendTo(i),d=0;n>d;d++)s.append('<div class="tr-indent-spacer"/>');var c=t('<div class="tr-tree-expander"></div>').appendTo(s),p=o(e,n);if(p.addClass("tr-tree-entry filterable-item").appendTo(s),s.mousedown(function(t){F.trigger("mousedown",t),g(e)}).mouseup(function(e){F.trigger("mouseup",e)}).mouseenter(function(){w(e)}),!r){var h=t('<div class="tr-tree-entry-children-wrapper"></div>').appendTo(i);if(c.mousedown(function(e){return!1}).click(function(t){u(e,!e[q.expandedProperty],!0)}),e[q.childrenProperty])for(var f=0;f<e[q.childrenProperty].length;f++)l(e[q.childrenProperty][f],n+1).appendTo(h);else e[q.lazyChildrenFlagProperty]&&h.hide().append(q.spinnerTemplate).fadeIn();u(e,e[q.expandedProperty],!1)}return i}function s(e){if(O.empty(),e.length>0)for(var t=0;t<e.length;t++)l(e[t],0).appendTo(O);else O.append(q.noEntriesTemplate)}function u(e,t,n){e[q.expandedProperty]=!!t,e._trEntryElement.toggleClass("expanded",!!t),t?e._trEntryElement.find("> .tr-tree-entry-children-wrapper").slideDown(n?q.animationDuration:0):e._trEntryElement.find("> .tr-tree-entry-children-wrapper").slideUp(n?q.animationDuration:0),t&&e[q.lazyChildrenFlagProperty]&&!e[q.childrenProperty]&&q.lazyChildrenQueryFunction(e,function(t){c(e,t)}),t&&m(e._trEntryElement)}function d(e){return e?parseInt(e._trEntryElement.attr("data-depth")):0}function c(e,t){e[q.childrenProperty]=t,e[q.lazyChildrenFlagProperty]=!1;var n=e._trEntryElement.find("> .tr-tree-entry-children-wrapper");if(n.empty(),t&&t.length>0)for(var r=d(e),i=0;i<t.length;i++){var a=t[i];l(a,r+1).appendTo(n)}else e._trEntryElement.removeClass("has-children expanded")}function p(e,t){S=null,k=e,s(k);var n=f(P);n&&v(n)}function h(e){function t(n,r){if(e.call(this,n)&&r.push(n),n[q.childrenProperty])for(var i=0;i<n[q.childrenProperty].length;i++){var a=n[q.childrenProperty][i];t(a,r)}}for(var n=[],r=0;r<k.length;r++){var i=k[r];t(i,n)}return n}function f(e){return h(function(t){return t[q.valueProperty]==e})[0]}function y(e){return h(function(t){return t[q.childrenProperty]&&-1!=t[q.childrenProperty].indexOf(e)})[0]}function g(e){P=e?e[q.valueProperty]:null,v(e),x()}function m(e){F.parent().minimallyScrollTo(e)}function v(e){if(O.find(".tr-selected-entry").removeClass("tr-selected-entry"),e){var t=e._trEntryElement.find(">.tr-tree-entry-and-expander-wrapper");t.addClass("tr-selected-entry"),m(t)}}function x(){F.trigger("change")}function w(e){if(e!==S)if(S=e,O.find(".tr-highlighted-entry").removeClass("tr-highlighted-entry"),null!=e){var t=e._trEntryElement.find(">.tr-tree-entry-and-expander-wrapper");t.addClass("tr-highlighted-entry"),m(t)}else{var n=C();n&&(S=n)}}function T(e){var t=b(S,e);null!=t&&w(t)}function b(e,t,n){var r,i=h(function(t){return n?t._trEntryElement.is(":visible")&&t._trEntryElement.has(">.tr-tree-entry-and-expander-wrapper .tr-highlighted-text").length>0:t._trEntryElement.is(":visible")||t===e});if(null==i||0==i.length)return null;if(null==e&&t>0)r=-1+t;else if(null==e&&0>t)r=i.length+t;else{var a=i.indexOf(e);r=(a+i.length+t)%i.length}return i[r]}function E(e){for(var t=0;t<k.length;t++){var n=k[t],r=n._trEntryElement.find(".tr-tree-entry");r.trivialHighlight(e,q.matchingOptions)}}function C(){return P?f(P):null}i=i||{};var P,_={valueProperty:"id",childrenProperty:"children",lazyChildrenFlagProperty:"hasLazyChildren",lazyChildrenQueryFunction:function(e,t){t(e.children||[])},expandedProperty:"expanded",templates:[e.iconSingleLineTemplate],spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,selectedEntryId:null,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2},animationDuration:70},q=t.extend(_,i),k=q.entries,S=null,F=t('<div class="tr-treebox"/>').appendTo(r),O=t('<div class="tr-tree-entryTree"></div>').appendTo(F);O.mouseleave(function(){w(null)}),k&&s(k),g(q.selectedEntryId?f(q.selectedEntryId):null),this.$=F,F[0].trivialTreeBox=this,this.updateEntries=p,this.getSelectedEntry=C,this.selectNode=function(e){g(f(e))},this.setHighlightedEntry=w,this.highlightNextEntry=T,this.highlightNextMatchingEntry=function(e){var t=b(S,e,!0);null!=t&&w(t)},this.getHighlightedEntry=function(){return S},this.highlightTextMatches=E,this.setHighlightedNodeExpanded=function(e){if(!S||a(S))return!1;var t=S[q.expandedProperty];return u(S,e,!0),!t!=!e},this.updateChildren=function(e,t){var n=f(e);n&&c(n,t)},this.updateNode=function(e){var t=f(e.id),n=y(t);n?n[q.childrenProperty][n[q.childrenProperty].indexOf(t)]=e:k[k.indexOf(t)]=e,l(e,d(t)).insertAfter(t._trEntryElement),t._trEntryElement.remove()},this.removeNode=function(e){var t=f(e);if(t){var n=y(t);n?n[q.childrenProperty].splice(n[q.childrenProperty].indexOf(t),1):k.splice(k.indexOf(t),1),t._trEntryElement.remove()}},this.addNode=function(e,t){var n=f(e);a(n),n[q.childrenProperty]||(n[q.childrenProperty]=[]),n[q.childrenProperty].push(t);var r=l(t,d(n)+1);r.appendTo(n._trEntryElement.find(">.tr-tree-entry-children-wrapper")),n._trEntryElement.addClass("has-children")}}return e.registerJqueryPlugin(r,"TrivialTreeBox","tr-treebox"),t.fn.TrivialTreeBox}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-treecombobox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialtreecombobox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,a){function o(e){var n=t(x.spinnerTemplate).appendTo(j);q=q.add(n),setTimeout(function(){x.queryFunction(L.val(),function(t){v(t,e)})},0)}function l(){k.triggerHandler("change"),S.trigger("change")}function s(e){if(null==e){x.valueProperty&&k.val(""),E=null;var r=t(n.render(x.selectedEntryTemplate,x.emptyEntry)).addClass("tr-combobox-entry").addClass("empty");F.empty().append(r)}else{x.valueProperty&&k.val(e[x.valueProperty]),E=e;var r=t(n.render(x.selectedEntryTemplate,e)).addClass("tr-combobox-entry");F.empty().append(r),L.val(e[x.inputTextProperty])}l()}function u(){return null!=E&&E!==x.emptyEntry}function d(){var e=F.find(".editor-area");L.css({width:e.width()+"px",height:e.height()+"px"}).position({my:"left top",at:"left top",of:e})}function c(){x.allowFreeText||u()||!(k.val().length>0||L.val().length>0)||(k.val(""),L.val(""),b=null,l())}function p(){x.allowFreeText&&L.val().length>0&&!u()||h()}function h(){L.width(0).height(0)}function f(){M&&(S.addClass("open"),N(),T=!0)}function y(){S.removeClass("open"),j.hide(),T=!1}function g(){return L.val().substring(0,L[0].selectionStart)}function m(e){if(x.autoComplete){clearTimeout(P);var t=w.getHighlightedEntry();if(t&&!_){var n=t[x.inputTextProperty];P=setTimeout(function(){var e,t=g();e=0===n.toLowerCase().indexOf(t.toLowerCase())?t+n.substr(t.length):g(),L.val(e),setTimeout(function(){L[0].setSelectionRange(t.length,e.length)},0)},e||0)}_=!1}}function v(e,n){b=e,q.remove(),q=t(),w.updateEntries(e);var r=g();r.length>0?(w.highlightTextMatches(r),w.highlightNextMatchingEntry(n)):w.highlightNextEntry(n),m(x.autoCompleteDelay),T&&f()}a=a||{};var x=t.extend({valueProperty:"id",inputTextProperty:"displayValue",templates:[e.iconSingleLineTemplate],selectedEntryTemplate:a.templates&&a.templates.length>0&&a.templates[0]||e.icon2LinesTemplate,selectedEntry:null,spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,emptyEntry:{},queryFunction:null,autoComplete:!0,autoCompleteDelay:0,allowFreeText:!1,freeTextEntryValues:{_isFreeTextEntry:!0},showTrigger:!0,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:2},childrenProperty:"children",lazyChildrenFlagProperty:"hasLazyChildren",expandedProperty:"expanded",editingMode:"editable"},a);x.queryFunction=x.queryFunction||e.defaultTreeQueryFunctionFactory(x.entries||[],x.matchingOptions,x.childrenProperty,x.expandedProperty);var w,T=!1,b=x.entries,E=null,C=!1,P=-1,_=!1,q=t(),k=t(r),S=t('<div class="tr-combobox tr-input-wrapper"/>').addClass(x.editingMode).insertAfter(k),F=t('<div class="tr-combobox-selected-entry-wrapper"/>').appendTo(S);if(x.showTrigger){var O=t('<div class="tr-trigger"><span class="tr-trigger-icon"/></div>').appendTo(S);O.mousedown(function(){T?(d(),y()):setTimeout(function(){d(),L.select(),f(),null==b&&o()})})}var j=t('<div class="tr-dropdown"></div>').scroll(function(e){return!1}),M="editable"==x.editingMode&&(x.entries&&x.entries.length>0||a.queryFunction||x.showTrigger);M&&j.appendTo("body");var L;x.valueProperty?(k.addClass("tr-original-input"),L=t('<input type="text"/>')):L=k,L.prependTo(S).addClass("tr-combobox-editor tr-editor").focus(function(){C||S.addClass("focus")}).blur(function(){C?L.focus():(S.removeClass("focus"),c(),p(),y())}).keydown(function(t){if(t.which!=i.tab&&!e.isModifierKey(t)){if(t.which==i.left_arrow||t.which==i.right_arrow){if(T){var n=w.setHighlightedNodeExpanded(t.which==i.right_arrow);if(n)return!1}return void d()}if((t.which==i.backspace||t.which==i["delete"])&&(_=!0),t.which==i.up_arrow||t.which==i.down_arrow){d(),f();var r=t.which==i.up_arrow?-1:1;if(null!=b)return w.highlightNextEntry(r),m(x.autoCompleteDelay),!1;o(r)}else T&&t.which==i.enter?(s(w.getHighlightedEntry()),y(),p(),L.select()):t.which==i.escape?(y(),c(),p()):(d(),f(),o(1))}}).keyup(function(t){!e.isModifierKey(t)&&t.which!=i.enter&&u()&&L.val()!==E[x.inputTextProperty]?s(null):t.which==i.tab&&d()}).mousedown(function(){f(),null==b&&o()}),S.add(j).mousedown(function(){L.is(":focus")&&(C=!0)}).mouseup(function(){C&&(L.focus(),C=!1)}).mouseout(function(){C&&(L.focus(),C=!1)}),w=j.TrivialTreeBox(x),w.$.change(function(){var e=w.getSelectedEntry();e&&(s(e),w.selectNode(null),y()),p()}),s(w.getSelectedEntry()),F.click(function(){d(),L.select(),f(),null==b&&o()});var N=function(){j.show().position({my:"left top",at:"left bottom",of:S,collision:"flip",using:function(e,n){"top"===n.vertical?(S.removeClass("dropdown-flipped"),t(this).removeClass("flipped")):(S.addClass("dropdown-flipped"),t(this).addClass("flipped")),t(this).css({left:e.left+"px",top:e.top+"px"})}}).width(S.width())};this.$=S,S[0].trivialTreeComboBox=this,this.updateEntries=v,this.getSelectedEntry=function(){if(null!=E||x.allowFreeText&&L.val()){if(null==E&&x.allowFreeText){var e=t.extend({},x.freeTextEntryValues);return e[x.inputTextProperty]=L.val(),e}var n=jQuery.extend({},E);return n._trEntryElement=void 0,n}return null},this.updateChildren=w.updateChildren,this.updateNode=w.updateNode,this.removeNode=w.removeNode}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialTreeComboBox","tr-combobox"),t.fn.TrivialTreeComboBox}),function(e){"use strict";"function"==typeof define&&define.amd?define("trivial-unitbox",["trivial-core","jquery","mustache"],e):"object"==typeof exports?module.exports=e(require("trivial-core"),require("jquery"),require("mustache")):jQuery&&!jQuery.fn.trivialunitbox&&e(TrivialComponents,jQuery,Mustache)}(function(e,t,n){function r(r,a){function o(e){var n=t(m.spinnerTemplate).appendTo(L);k=k.add(n),setTimeout(function(){m.queryFunction(N(),function(t){g(t);var n=N();n.length>0?(v.highlightTextMatches(n),v.highlightNextMatchingEntry(e)):v.highlightNextEntry(e),h(m.autoCompleteDelay),x&&d()})})}function l(){S.trigger("change"),O.trigger("change")}function s(e,r){if(null==e){T=null;var i=t(n.render(m.selectedEntryTemplate,m.emptyEntry)).addClass("tr-combobox-entry").addClass("empty");M.empty().append(i)}else{T=e;var i=t(n.render(m.selectedEntryTemplate,e)).addClass("tr-combobox-entry");M.empty().append(i)}u(),r||l()}function u(){var e=/[\d\.]+/.exec(F.val());e?F.val(F.val().substr(e.index,e[0].length)):F.val("")}function d(){O.addClass("open"),L.show().position({my:"left top",at:"left bottom",of:O,collision:"flip",using:function(e,n){"top"===n.vertical?(O.removeClass("dropdown-flipped"),t(this).removeClass("flipped")):(O.addClass("dropdown-flipped"),t(this).addClass("flipped")),t(this).css({left:e.left+"px",top:e.top+"px"})}}).width(O.width()),x=!0}function c(){O.removeClass("open"),L.hide(),x=!1}function p(){return F[0].selectionStart<F[0].selectionEnd&&F[0].selectionEnd===F.val().length?F.val().substring(0,F[0].selectionStart):F.val()}function h(e){if(m.autoComplete){clearTimeout(E);var t=v.getHighlightedEntry();if(t&&!C){var n=t[m.inputTextProperty];E=setTimeout(function(){var e,t=p(),r=N();e=0===n.toLowerCase().indexOf(r.toLowerCase())?t+n.substr(r.length):p(),F.val(e),setTimeout(function(){F[0].setSelectionRange(t.length,e.length)},0)},e||0)}C=!1}}function f(){var e=F.val().match(P);return e&&e[0]}function y(e){s(w.filter(function(t){return t[m.idProperty]===e})[0],!0)}function g(e){w=e,k.remove(),k=t(),v.updateEntries(e)}a=a||{};var m=t.extend({unitValueProperty:"code",idProperty:"code",decimalSeparator:".",decimalPrecision:2,unitDisplayPosition:"right",inputTextProperty:"code",template:e.currency2LineTemplate,selectedEntryTemplate:e.currencySingleLineShortTemplate,selectedEntry:void 0,spinnerTemplate:e.defaultSpinnerTemplate,noEntriesTemplate:e.defaultNoEntriesTemplate,entries:null,emptyEntry:{code:"..."},queryFunction:null,queryOnNonNumberFields:!0,openDropdownOnEditorClick:!1,autoComplete:!0,autoCompleteDelay:0,showTrigger:!0,matchingOptions:{matchingMode:"prefix-word",ignoreCase:!0,maxLevenshteinDistance:2}},a);m.queryFunction=m.queryFunction||e.defaultListQueryFunctionFactory(m.entries||[],m.matchingOptions);var v,x=!1,w=m.entries,T=null,b=!1,E=-1,C=!1,P=new RegExp("\\d+(?:\\"+m.decimalSeparator+"\\d*)?"),_=new RegExp("[^\\d\\"+m.decimalSeparator+" ]"),q=new RegExp("[^\\d\\"+m.decimalSeparator+" ](?=[\\d\\"+m.decimalSeparator+" ]*$)"),k=t(),S=t(r).addClass("tr-original-input"),F=t('<input type="text"/>'),O=t('<div class="tr-unitbox tr-input-wrapper"/>').insertAfter(S).addClass("left"===m.unitDisplayPosition?"unit-display-left":"unit-display-right");S.appendTo(O);var j=t('<div class="tr-unitbox-selected-entry-and-trigger-wrapper"/>').appendTo(O),M=t('<div class="tr-unitbox-selected-entry-wrapper"/>').appendTo(j);if(m.showTrigger){t('<div class="tr-trigger"><span class="tr-trigger-icon"/></div>').appendTo(j)}j.mousedown(function(){x?c():setTimeout(function(){d(),o()}),F.focus()});var L=t('<div class="tr-dropdown"></div>').appendTo("body");F.prependTo(O).addClass("tr-unitbox-editor tr-editor").focus(function(){b||O.addClass("focus")}).blur(function(){b?F.focus():(O.removeClass("focus"),u(),c())}).keydown(function(t){if(t.which!=i.tab&&!e.isModifierKey(t)&&t.which!=i.left_arrow&&t.which!=i.right_arrow){if((t.which==i.backspace||t.which==i["delete"])&&(C=!0),t.which==i.up_arrow||t.which==i.down_arrow){var n=t.which==i.up_arrow?-1:1;return x?(v.highlightNextEntry(n),h(m.autoCompleteDelay)):(d(),o(n)),!1}if(x&&t.which==i.enter)s(v.getHighlightedEntry()),c();else if(t.which==i.escape)c(),u();else if(!t.shiftKey&&-1!=i.numberKeys.indexOf(t.which)){var r=Q(),a=r.indexOf(m.decimalSeparator);if(-1!=a&&r.length-(a+1)>=m.decimalPrecision)return!1}}}).keypress(function(e){String.fromCharCode(e.which)}).keyup(function(e){-1!=i.specialKeys.indexOf(e.which)&&e.which!=i.backspace&&e.which!=i["delete"]||(N().length>0&&m.queryOnNonNumberFields?(d(),o(1)):c())}).mousedown(function(){m.openDropdownOnEditorClick&&(d(),null==w&&o())}).change(function(){D(),l()}),O.add(L).mousedown(function(){F.is(":focus")&&(b=!0)}).mouseup(function(){b&&(F.focus(),b=!1)}).mouseout(function(){b&&(F.focus(),b=!1)}),v=L.TrivialListBox(m),v.$.change(function(){var e=v.getSelectedEntry();e&&(s(e,!0),v.selectEntry(null),D(),c(),l())}),s(m.selectedEntry||null);var N=function(){var e=p(),t=e.search(_),n=e.search(q);return-1!=t?e.substring(t,n+1):""},Q=function(){var e=P.exec(F.val());return e?e[0]:""},D=function(){"left"===m.unitDisplayPosition?S.val((T?T[m.unitValueProperty]:"")+" "+f()):S.val(f()+" "+(T?T[m.unitValueProperty]:""))};this.$=O,O[0].trivialUnitBox=this,this.updateEntries=g,this.getSelectedUnit=function(){if(null==T)return null;var e=jQuery.extend({},T);return e._trEntryElement=void 0,e},this.getAmount=f,this.setAmount=function(e){F.val(e)},this.selectEntry=s,this.selectUnit=y}var i=e.keyCodes;return e.registerJqueryPlugin(r,"TrivialUnitBox","tr-unitbox"),t.fn.TrivialUnitBox});